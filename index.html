<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovelGuess - Daily Book Game</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Inter:wght@400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f5f2; /* Paper-like off-white */
        }
        
        .serif {
            font-family: 'Merriweather', serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .clue-reveal-enter {
            opacity: 0;
            transform: translateY(10px);
        }
        .clue-reveal-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 300ms, transform 300ms;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- ICONS (Inline) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Book = (props) => <Icon {...props} path={<><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" /><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" /></>} />;
        const User = (props) => <Icon {...props} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>} />;
        const HelpCircle = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10" /><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /><line x1="12" y1="17" x2="12.01" y2="17" /></>} />;
        const SkipForward = (props) => <Icon {...props} path={<><polygon points="5 4 15 12 5 20 5 4" /><line x1="19" y1="5" x2="19" y2="19" /></>} />;
        const Check = (props) => <Icon {...props} path={<polyline points="20 6 9 17 4 12" />} />;
        const X = (props) => <Icon {...props} path={<><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>} />;
        const Trophy = (props) => <Icon {...props} path={<><path d="M8 21h8" /><path d="M12 17v4" /><path d="M7 4h10" /><path d="M17 4v3a5 5 0 0 1-10 0V4" /><line x1="10" y1="2" x2="14" y2="2" /><path d="M21 7v3a8 8 0 0 1-5 7.6V8" /><path d="M3 7v3a8 8 0 0 0 5 7.6V8" /></>} />;
        const Search = (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></>} />;
        const BookOpen = (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></>} />;
        const MapPin = (props) => <Icon {...props} path={<><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /><circle cx="12" cy="10" r="3" /></>} />;
        const Brain = (props) => <Icon {...props} path={<><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z" /><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" /></>} />;
        const Heart = (props) => <Icon {...props} path={<path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />} />;
        const Quote = (props) => <Icon {...props} path={<><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z" /><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z" /></>} />;
        const Calendar = (props) => <Icon {...props} path={<><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></>} />;

        const ICON_MAP = {
            "Book": Book, "User": User, "MapPin": MapPin, "Search": Search,
            "Quote": Quote, "Brain": Brain, "Heart": Heart, "BookOpen": BookOpen
        };

        // --- GAME DATA ---
        // In a real app, this array should be HUGE (365+ entries).
        const GAMES_DB = [
            {
                id: 1,
                title: "The Great Gatsby",
                author: "F. Scott Fitzgerald",
                clues: [
                    { type: "Genre & Style", text: "A modernist tragedy set in the Jazz Age, dealing with themes of decadence and idealism.", icon: "Book" },
                    { type: "Setting", text: "Long Island, New York. specifically the fictional villages of West Egg and East Egg.", icon: "MapPin" },
                    { type: "Character", text: "A narrator named Nick who moves next door to a mysterious millionaire.", icon: "User" },
                    { type: "Plot Detail", text: "The protagonist is obsessed with a green light at the end of a dock across the water.", icon: "Search" },
                    { type: "Famous Quote", text: "'So we beat on, boats against the current, borne back ceaselessly into the past.'", icon: "Quote" }
                ]
            },
            {
                id: 2,
                title: "1984",
                author: "George Orwell",
                clues: [
                    { type: "Genre & Style", text: "A dystopian social science fiction novel and cautionary tale.", icon: "Book" },
                    { type: "Concept", text: "Introduced terms like 'Doublethink', 'Thoughtcrime', and 'Newspeak' into the lexicon.", icon: "Brain" },
                    { type: "Setting", text: "A superstate called Oceania, ruled by the Party who employs the Thought Police.", icon: "MapPin" },
                    { type: "Character", text: "Winston Smith, a low-ranking member of the Party who works at the Ministry of Truth.", icon: "User" },
                    { type: "Famous Phrase", text: "'Big Brother is watching you.'", icon: "Quote" }
                ]
            },
            {
                id: 3,
                title: "Pride and Prejudice",
                author: "Jane Austen",
                clues: [
                    { type: "Genre & Style", text: "A romantic novel of manners written in the early 19th century.", icon: "Book" },
                    { type: "Setting", text: "Hertfordshire and Derbyshire in rural England.", icon: "MapPin" },
                    { type: "Plot", text: "A mother is desperate to marry off her five daughters to wealthy suitors.", icon: "Heart" },
                    { type: "Character", text: "Elizabeth, who initially detests the wealthy but aloof Mr. Darcy.", icon: "User" },
                    { type: "Famous Quote", text: "'It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife.'", icon: "Quote" }
                ]
            }
        ];

        const BOOK_LIST = [
            "The Great Gatsby", "1984", "Pride and Prejudice", "To Kill a Mockingbird", "The Catcher in the Rye", 
            "Moby Dick", "War and Peace", "Hamlet", "The Odyssey", "Ulysses", "Brave New World", 
            "The Lord of the Rings", "Harry Potter and the Sorcerer's Stone", "The Hobbit", "Fahrenheit 451", 
            "Jane Eyre", "Wuthering Heights", "Animal Farm", "Lord of the Flies", "The Grapes of Wrath", 
            "Little Women", "Frankenstein", "Dracula"
        ];

        // --- COMPONENTS ---

        const ClueBox = ({ clue, index, revealed, isNew }) => {
            if (!revealed) return (
                <div className="h-20 border-2 border-dashed border-gray-300 rounded-xl flex items-center justify-center text-gray-400 bg-gray-50 mb-3">
                    <span className="text-sm font-semibold tracking-wider">CLUE {index + 1} LOCKED</span>
                </div>
            );

            const IconComponent = ICON_MAP[clue.icon] || BookOpen;

            return (
                <div className={`relative overflow-hidden bg-white border border-gray-200 rounded-xl shadow-sm p-4 mb-3 transition-all duration-500 ${isNew ? 'ring-2 ring-indigo-200 animate-pulse' : ''}`}>
                    <div className="flex items-start gap-3">
                        <div className="bg-indigo-100 p-2 rounded-lg text-indigo-700 shrink-0">
                             <IconComponent size={20} />
                        </div>
                        <div>
                            <p className="text-xs font-bold text-indigo-600 uppercase tracking-wide mb-1">{clue.type}</p>
                            <p className="serif text-gray-800 text-lg leading-snug">{clue.text}</p>
                        </div>
                    </div>
                </div>
            );
        };

        const GuessRow = ({ guess, status }) => {
            let bgColor = "bg-gray-100";
            let borderColor = "border-gray-200";
            let icon = null;

            if (status === "skipped") {
                bgColor = "bg-gray-100";
                borderColor = "border-gray-300";
                icon = <SkipForward size={16} className="text-gray-500" />;
            } else if (status === "wrong") {
                bgColor = "bg-red-50";
                borderColor = "border-red-200";
                icon = <X size={16} className="text-red-500" />;
            } else if (status === "correct") {
                bgColor = "bg-green-50";
                borderColor = "border-green-200";
                icon = <Check size={16} className="text-green-600" />;
            }

            return (
                <div className={`${bgColor} border ${borderColor} rounded-lg p-3 mb-2 flex items-center justify-between`}>
                    <span className={`font-medium ${status === 'skipped' ? 'text-gray-500 italic' : 'text-gray-800'}`}>
                        {guess || "Skipped"}
                    </span>
                    {icon}
                </div>
            );
        };

        const App = () => {
            // DAILY LOGIC
            // 1. Calculate "Game ID" based on date.
            // This ensures everyone gets the same game on the same day.
            const getDailyGameIndex = () => {
                const epoch = new Date("2024-01-01T00:00:00");
                const today = new Date();
                today.setHours(0,0,0,0); // normalize
                const diffTime = Math.abs(today - epoch);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                return diffDays % GAMES_DB.length;
            };

            const [gameId, setGameId] = useState(getDailyGameIndex());
            const [clueLevel, setClueLevel] = useState(0); 
            const [guesses, setGuesses] = useState([]); 
            const [gameStatus, setGameStatus] = useState('playing'); // playing, won, lost
            const [searchQuery, setSearchQuery] = useState('');
            const [showSuggestions, setShowSuggestions] = useState(false);
            
            const currentGame = GAMES_DB[gameId];
            const maxGuesses = 5;

            // Load Progress from LocalStorage on mount
            useEffect(() => {
                const todayStr = new Date().toISOString().split('T')[0]; // "2023-10-27"
                const savedState = localStorage.getItem(`novelguess-${todayStr}`);
                
                if (savedState) {
                    const parsed = JSON.parse(savedState);
                    setGuesses(parsed.guesses);
                    setClueLevel(parsed.clueLevel);
                    setGameStatus(parsed.gameStatus);
                }
            }, []);

            // Save Progress to LocalStorage on change
            useEffect(() => {
                const todayStr = new Date().toISOString().split('T')[0];
                const stateToSave = {
                    guesses,
                    clueLevel,
                    gameStatus
                };
                localStorage.setItem(`novelguess-${todayStr}`, JSON.stringify(stateToSave));
            }, [guesses, clueLevel, gameStatus]);

            const filteredBooks = BOOK_LIST.filter(b => 
                b.toLowerCase().includes(searchQuery.toLowerCase())
            ).slice(0, 5); 

            // --- ACTIONS ---

            const handleGuess = (bookTitle) => {
                if (gameStatus !== 'playing') return;

                const isCorrect = bookTitle.toLowerCase() === currentGame.title.toLowerCase();
                const newGuess = { text: bookTitle, status: isCorrect ? 'correct' : 'wrong' };
                const newGuesses = [...guesses, newGuess];
                
                setGuesses(newGuesses);
                setSearchQuery('');
                setShowSuggestions(false);

                if (isCorrect) {
                    setGameStatus('won');
                    setClueLevel(4); 
                } else {
                    if (newGuesses.length >= maxGuesses) {
                        setGameStatus('lost');
                        setClueLevel(4);
                    } else {
                        if (clueLevel < 4) setClueLevel(clueLevel + 1);
                    }
                }
            };

            const handleSkip = () => {
                if (gameStatus !== 'playing') return;

                const newGuess = { text: "Skipped", status: 'skipped' };
                const newGuesses = [...guesses, newGuess];
                setGuesses(newGuesses);

                if (newGuesses.length >= maxGuesses) {
                    setGameStatus('lost');
                    setClueLevel(4);
                } else {
                    if (clueLevel < 4) setClueLevel(clueLevel + 1);
                }
            };

            return (
                <div className="min-h-screen flex flex-col max-w-lg mx-auto bg-white shadow-2xl min-h-screen border-x border-gray-100">
                    
                    {/* HEADER */}
                    <header className="p-4 border-b border-gray-100 bg-white sticky top-0 z-10 flex items-center justify-between">
                        <div className="flex items-center gap-2">
                            <BookOpen className="text-indigo-600" />
                            <h1 className="text-xl font-bold tracking-tight text-gray-900">NovelGuess</h1>
                        </div>
                        <div className="flex gap-3">
                            <div className="flex items-center gap-1 text-xs font-semibold bg-gray-100 px-2 py-1 rounded text-gray-500">
                                <Calendar size={14} />
                                <span>DAILY #{gameId + 1}</span>
                            </div>
                            <button className="text-gray-400 hover:text-indigo-600 transition"><HelpCircle size={20} /></button>
                        </div>
                    </header>

                    <main className="flex-1 p-4 pb-32 overflow-y-auto">
                        
                        {/* PROGRESS INDICATOR */}
                        <div className="flex gap-1 mb-6">
                            {[0,1,2,3,4].map(i => (
                                <div key={i} className={`h-1.5 flex-1 rounded-full transition-colors duration-300 ${
                                    i < guesses.length ? (guesses[i].status === 'correct' ? 'bg-green-500' : guesses[i].status === 'skipped' ? 'bg-gray-400' : 'bg-red-400') : 'bg-gray-100'
                                }`}></div>
                            ))}
                        </div>

                        {/* CLUES AREA */}
                        <div className="mb-6">
                            {currentGame.clues.map((clue, index) => (
                                <ClueBox 
                                    key={index} 
                                    clue={clue} 
                                    index={index} 
                                    revealed={index <= clueLevel}
                                    isNew={index === clueLevel && gameStatus === 'playing'} 
                                />
                            ))}
                        </div>

                        {/* GUESS HISTORY */}
                        {guesses.length > 0 && (
                            <div className="mb-6">
                                <h3 className="text-xs font-bold text-gray-400 uppercase mb-2">Your Guesses</h3>
                                {guesses.map((g, i) => (
                                    <GuessRow key={i} guess={g.text} status={g.status} />
                                ))}
                            </div>
                        )}
                        
                        {/* END SCREEN (WIN/LOSS) */}
                        {gameStatus !== 'playing' && (
                            <div className={`p-6 rounded-xl text-center mb-6 animate-in fade-in slide-in-from-bottom-4 duration-500 ${gameStatus === 'won' ? 'bg-green-50 border border-green-100' : 'bg-red-50 border border-red-100'}`}>
                                <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-white shadow-sm mb-3">
                                    {gameStatus === 'won' ? <Trophy className="text-green-600" /> : <Book className="text-red-500" />}
                                </div>
                                <h2 className="text-2xl font-bold mb-1 serif text-gray-900">{currentGame.title}</h2>
                                <p className="text-gray-600 mb-4">by {currentGame.author}</p>
                                
                                <div className="text-sm font-medium mb-6">
                                    {gameStatus === 'won' ? 
                                        <span className="text-green-700">You got it in {guesses.length} guess{guesses.length !== 1 ? 'es' : ''}!</span> : 
                                        <span className="text-red-700">Better luck next time!</span>
                                    }
                                </div>
                                
                                <div className="bg-gray-100 rounded-lg p-4 text-sm text-gray-500">
                                    Come back tomorrow for a new book!
                                </div>
                            </div>
                        )}

                    </main>

                    {/* INPUT AREA (Fixed at bottom) */}
                    {gameStatus === 'playing' && (
                        <div className="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100 max-w-lg mx-auto">
                            <div className="relative">
                                {/* Search Input */}
                                <div className="relative">
                                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
                                    <input 
                                        type="text" 
                                        placeholder="Search for a book title..." 
                                        className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                                        value={searchQuery}
                                        onChange={(e) => {
                                            setSearchQuery(e.target.value);
                                            setShowSuggestions(true);
                                        }}
                                        onFocus={() => setShowSuggestions(true)}
                                    />
                                </div>

                                {/* Autocomplete Dropdown */}
                                {showSuggestions && searchQuery.length > 0 && (
                                    <div className="absolute bottom-full left-0 right-0 mb-2 bg-white rounded-xl shadow-xl border border-gray-100 max-h-60 overflow-y-auto z-20">
                                        {filteredBooks.length > 0 ? (
                                            filteredBooks.map((book, idx) => (
                                                <button
                                                    key={idx}
                                                    className="w-full text-left px-4 py-3 hover:bg-indigo-50 transition border-b border-gray-50 last:border-0 text-gray-700"
                                                    onClick={() => handleGuess(book)}
                                                >
                                                    {book}
                                                </button>
                                            ))
                                        ) : (
                                            <div className="px-4 py-3 text-gray-400 text-sm">No books found</div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Controls */}
                            <div className="flex gap-3 mt-3">
                                <button 
                                    onClick={handleSkip}
                                    className="flex-1 py-3 px-4 bg-white border border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition flex items-center justify-center gap-2"
                                >
                                    <SkipForward size={18} />
                                    Skip (+1 Clue)
                                </button>
                            </div>
                            <p className="text-center text-xs text-gray-400 mt-2">Guess {guesses.length + 1} of {maxGuesses}</p>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
